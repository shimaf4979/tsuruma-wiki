openapi: 3.1.0
info:
  title: é¶´èˆã“ã‚ã‚‰Wiki API
  description: |
    ğŸ¨ **é¶´èˆã“ã‚ã‚‰Wiki ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API**

    ã¿ã‚“ãªã§ä½œã‚‹åœ°åŸŸæƒ…å ±Wikiã‚µã‚¤ãƒˆã®ãŸã‚ã®RESTful API

    ## ğŸ” èªè¨¼ã«ã¤ã„ã¦
    - JWT Bearer Tokenã‚’ä½¿ç”¨
    - `Authorization: Bearer <token>` ãƒ˜ãƒƒãƒ€ãƒ¼ã§èªè¨¼
    - ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™: 7æ—¥é–“

    ## ğŸ‘¥ æ¨©é™ãƒ¬ãƒ™ãƒ«
    - **contributor**: ãƒšãƒ¼ã‚¸ä½œæˆï¼ˆä¸‹æ›¸ãï¼‰ã€ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿
    - **editor**: ãƒšãƒ¼ã‚¸ä½œæˆãƒ»ç·¨é›†ãƒ»å³æ™‚å…¬é–‹ã€ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†
    - **moderator**: ãƒšãƒ¼ã‚¸æ‰¿èªã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    - **admin**: å…¨ã¦ã®æ“ä½œã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®š

    ## ğŸ“Š ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆ
    - èªè¨¼: 15åˆ†é–“ã§5å›
    - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰: 1åˆ†é–“ã§10å›
    - æ¤œç´¢: 1åˆ†é–“ã§30å›
    - ä¸€èˆ¬API: 1åˆ†é–“ã§100å›

    ## ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼
    - `X-Request-ID`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡ID
    - `X-Response-Time`: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
    - `X-RateLimit-*`: ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±

  version: 1.0.0
  contact:
    name: é¶´èˆã“ã‚ã‚‰é‹å–¶ãƒãƒ¼ãƒ 
    email: info@tsuruma-koala.com
    url: https://tsuruma-koala.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: https://tsuruma-koala.com/terms

servers:
  - url: https://api.tsuruma-koala.com
    description: ğŸŒŸ æœ¬ç•ªç’°å¢ƒ
  - url: https://staging-api.tsuruma-koala.com
    description: ğŸ§ª ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ
  - url: http://localhost:8787
    description: ğŸ’» ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

tags:
  - name: health
    description: ğŸ¥ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ»ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
  - name: auth
    description: ğŸ” èªè¨¼ãƒ»èªå¯
  - name: users
    description: ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
  - name: wiki
    description: ğŸ“ Wikiãƒšãƒ¼ã‚¸æ“ä½œ
  - name: comments
    description: ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½
  - name: upload
    description: ğŸ“· ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - name: search
    description: ğŸ” æ¤œç´¢æ©Ÿèƒ½
  - name: admin
    description: ğŸ›¡ï¸ ç®¡ç†è€…æ©Ÿèƒ½

paths:
  # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  /:
    get:
      summary: ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
      description: APIã®ç¨¼åƒçŠ¶æ³ã¨ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã‚’ç¢ºèª
      tags:
        - health
      responses:
        "200":
          description: âœ… ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "ğŸ¨ é¶´èˆã“ã‚ã‚‰ Wiki API"
                  version:
                    type: string
                    example: "1.0.0"
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                  environment:
                    type: string
                    example: "production"

  /api:
    get:
      summary: APIæƒ…å ±å–å¾—
      description: åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—
      tags:
        - health
      responses:
        "200":
          description: APIæƒ…å ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "é¶´èˆã“ã‚ã‚‰Wiki API"
                  version:
                    type: string
                    example: "1.0.0"
                  documentation:
                    type: string
                    example: "https://api.tsuruma-koala.com/docs"
                  endpoints:
                    type: object
                    properties:
                      auth:
                        type: string
                        example: "/api/auth"
                      users:
                        type: string
                        example: "/api/users"
                      wiki:
                        type: string
                        example: "/api/wiki"
                      comments:
                        type: string
                        example: "/api/comments"
                      upload:
                        type: string
                        example: "/api/upload"
                      search:
                        type: string
                        example: "/api/search"
                      admin:
                        type: string
                        example: "/api/admin"

  /debug:
    get:
      summary: ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—
      description: é–‹ç™ºç’°å¢ƒã§ã®è¨­å®šç¢ºèªç”¨
      tags:
        - health
      responses:
        "200":
          description: ãƒ‡ãƒãƒƒã‚°æƒ…å ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  hasDB:
                    type: boolean
                  hasJWT:
                    type: boolean
                  timestamp:
                    type: string
                    format: date-time

  # èªè¨¼é–¢é€£
  /api/auth/test:
    get:
      summary: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
      description: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèª
      tags:
        - auth
      responses:
        "200":
          description: âœ… èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Secure auth route is working"
                  timestamp:
                    type: string
                    format: date-time
                  routes:
                    type: array
                    items:
                      type: string
                  security:
                    type: string
                    example: "Password authentication enabled"

  /api/auth/register:
    post:
      summary: ğŸ†• ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
      description: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãæ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - nickname
                - email
                - password
              properties:
                nickname:
                  type: string
                  minLength: 1
                  maxLength: 20
                  pattern: "^[a-zA-Z0-9\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF\\s]+$"
                  example: "ã“ã‚ã‚‰ã¡ã‚ƒã‚“"
                  description: "æ—¥æœ¬èªã€è‹±æ•°å­—ã€ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ä½¿ç”¨å¯èƒ½"
                email:
                  type: string
                  format: email
                  maxLength: 100
                  example: "koala@example.com"
                password:
                  type: string
                  minLength: 6
                  example: "securepassword123"
                  description: "æœ€ä½6æ–‡å­—ä»¥ä¸Š"
            examples:
              normal_user:
                summary: é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼
                value:
                  nickname: "é¶´èˆå¤ªéƒ"
                  email: "taro@example.com"
                  password: "password123"
              contributor:
                summary: ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼
                value:
                  nickname: "åœ°åŸŸæ„›å¥½å®¶"
                  email: "local@example.com"
                  password: "mypassword456"
      responses:
        "201":
          description: âœ… ç™»éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          $ref: "#/components/responses/ValidationError"
        "409":
          description: âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ—¢å­˜
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "User already exists with this email"
                code: "USER_EXISTS"

  /api/auth/login:
    post:
      summary: ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³
      description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "koala@example.com"
                password:
                  type: string
                  example: "securepassword123"
            examples:
              login_example:
                summary: ãƒ­ã‚°ã‚¤ãƒ³ä¾‹
                value:
                  email: "taro@example.com"
                  password: "password123"
      responses:
        "200":
          description: âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: âŒ èªè¨¼å¤±æ•—
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalid_credentials:
                  summary: èªè¨¼æƒ…å ±ç„¡åŠ¹
                  value:
                    error: "Invalid email or password"
                    code: "INVALID_CREDENTIALS"

  /api/auth/verify:
    get:
      summary: ğŸ” ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
      description: JWTãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª
      tags:
        - auth
      security:
        - bearerAuth: []
      responses:
        "200":
          description: âœ… ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  user:
                    $ref: "#/components/schemas/PublicUser"
        "401":
          description: âŒ ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid or expired token"

  # ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£
  /api/users/me:
    get:
      summary: ğŸ‘¤ è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
      description: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
      tags:
        - users
      security:
        - bearerAuth: []
      responses:
        "200":
          description: âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"

    put:
      summary: âœï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
      description: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’æ›´æ–°
      tags:
        - users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nickname:
                  type: string
                  minLength: 1
                  maxLength: 20
                  pattern: "^[a-zA-Z0-9\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF\\s]+$"
                bio:
                  type: string
                  maxLength: 200
                  example: "é¶´èˆåœ°åŸŸãŒå¤§å¥½ãã§ã™ï¼"
                avatarUrl:
                  type: string
                  format: uri
                  example: "https://images.tsuruma-koala.com/user123/avatar.jpg"
            examples:
              update_profile:
                summary: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°ä¾‹
                value:
                  nickname: "æ–°ã—ã„ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ "
                  bio: "åœ°åŸŸæƒ…å ±ã‚’ç™ºä¿¡ã—ã¦ã„ãã¾ã™ï¼"
      responses:
        "200":
          description: âœ… æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/users/{userId}:
    get:
      summary: ğŸ‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¬é–‹æƒ…å ±å–å¾—
      description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¬é–‹æƒ…å ±ã‚’å–å¾—
      tags:
        - users
      parameters:
        - name: userId
          in: path
          schema:
            type: string
          example: "user-123"
      responses:
        "200":
          description: âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: "#/components/schemas/PublicUser"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/users/{userId}/pages:
    get:
      summary: ğŸ“„ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ãƒšãƒ¼ã‚¸ä¸€è¦§
      description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸå…¬é–‹ãƒšãƒ¼ã‚¸ã®ä¸€è¦§ã‚’å–å¾—
      tags:
        - users
      parameters:
        - name: userId
          in: path
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¸ä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  pages:
                    type: array
                    items:
                      $ref: "#/components/schemas/WikiPage"
        "404":
          $ref: "#/components/responses/NotFound"

  # Wikiãƒšãƒ¼ã‚¸é–¢é€£
  /api/wiki:
    get:
      summary: ğŸ“š ãƒšãƒ¼ã‚¸ä¸€è¦§å–å¾—
      description: å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã®ä¸€è¦§ã‚’å–å¾—ï¼ˆæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¯¾å¿œï¼‰
      tags:
        - wiki
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [published, draft]
            default: published
          description: ãƒšãƒ¼ã‚¸ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        - name: search
          in: query
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»æœ¬æ–‡ï¼‰
          example: "ã‚«ãƒ•ã‚§"
        - name: tag
          in: query
          schema:
            type: string
            maxLength: 20
          description: ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          example: "ã‚°ãƒ«ãƒ¡"
        - name: author
          in: query
          schema:
            type: string
          description: è‘—è€…IDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: âœ… ãƒšãƒ¼ã‚¸ä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  pages:
                    type: array
                    items:
                      $ref: "#/components/schemas/WikiPage"
                  total:
                    type: integer
                    example: 156
                  hasMore:
                    type: boolean
                    example: true

    post:
      summary: âœï¸ ãƒšãƒ¼ã‚¸ä½œæˆ
      description: æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’ä½œæˆï¼ˆæ¨©é™ã«ã‚ˆã‚Šä¸‹æ›¸ãã¾ãŸã¯å³æ™‚å…¬é–‹ï¼‰
      tags:
        - wiki
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WikiPageCreate"
            examples:
              cafe_article:
                summary: ã‚«ãƒ•ã‚§ãƒšãƒ¼ã‚¸ä¾‹
                value:
                  title: "æ–°ã‚ªãƒ¼ãƒ—ãƒ³ï¼ç´ æ•µãªã‚«ãƒ•ã‚§"
                  content: "<h2>æ–°ã—ã„ã‚«ãƒ•ã‚§ãŒã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ</h2><p>ç¾å‘³ã—ã„ã‚³ãƒ¼ãƒ’ãƒ¼ã¨æ‰‹ä½œã‚Šã‚±ãƒ¼ã‚­ãŒæ¥½ã—ã‚ã¾ã™ã€‚</p>"
                  tags: ["ã‚«ãƒ•ã‚§", "æ–°åº—èˆ—", "ã‚°ãƒ«ãƒ¡"]
              event_article:
                summary: ã‚¤ãƒ™ãƒ³ãƒˆãƒšãƒ¼ã‚¸ä¾‹
                value:
                  title: "ğŸŒ¸ æ˜¥ã®æ¡œã¾ã¤ã‚Šé–‹å‚¬"
                  content: "<h2>æ¡œã¾ã¤ã‚Šã®ãŠçŸ¥ã‚‰ã›</h2><p>ä»Šå¹´ã‚‚ç¾ã—ã„æ¡œãŒå’²ãã¾ã—ãŸã€‚</p>"
                  tags: ["ã‚¤ãƒ™ãƒ³ãƒˆ", "æ¡œ", "æ˜¥"]
      responses:
        "201":
          description: âœ… ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Page created successfully"
                  id:
                    type: string
                    example: "page-123"
                  status:
                    type: string
                    enum: [published, draft]
                    description: "æ¨©é™ã«ã‚ˆã‚Šæ±ºå®šã•ã‚Œã‚‹å…¬é–‹çŠ¶æ…‹"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/wiki/popular:
    get:
      summary: ğŸ”¥ äººæ°—ãƒšãƒ¼ã‚¸å–å¾—
      description: ãƒ“ãƒ¥ãƒ¼æ•°é †ã®äººæ°—ãƒšãƒ¼ã‚¸ã‚’å–å¾—
      tags:
        - wiki
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        "200":
          description: âœ… äººæ°—ãƒšãƒ¼ã‚¸ä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  pages:
                    type: array
                    items:
                      $ref: "#/components/schemas/WikiPage"

  /api/wiki/{pageId}:
    get:
      summary: ğŸ“– ãƒšãƒ¼ã‚¸è©³ç´°å–å¾—
      description: æŒ‡å®šã—ãŸãƒšãƒ¼ã‚¸ã®è©³ç´°ã‚’å–å¾—ï¼ˆãƒ“ãƒ¥ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆ+1ï¼‰
      tags:
        - wiki
      parameters:
        - name: pageId
          in: path
          schema:
            type: string
          example: "page-123"
      responses:
        "200":
          description: âœ… ãƒšãƒ¼ã‚¸è©³ç´°
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    $ref: "#/components/schemas/WikiPage"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      summary: âœï¸ ãƒšãƒ¼ã‚¸æ›´æ–°
      description: ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ï¼ˆä½œè€…ã¾ãŸã¯ç·¨é›†è€…ä»¥ä¸Šã®ã¿ï¼‰
      tags:
        - wiki
      security:
        - bearerAuth: []
      parameters:
        - name: pageId
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WikiPageUpdate"
      responses:
        "200":
          description: âœ… æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      summary: ğŸ—‘ï¸ ãƒšãƒ¼ã‚¸å‰Šé™¤
      description: ãƒšãƒ¼ã‚¸ã‚’å‰Šé™¤ï¼ˆä½œè€…ã¾ãŸã¯ç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - wiki
      security:
        - bearerAuth: []
      parameters:
        - name: pageId
          in: path
          schema:
            type: string
      responses:
        "200":
          description: âœ… å‰Šé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/wiki/{pageId}/approve:
    post:
      summary: âœ… ãƒšãƒ¼ã‚¸æ‰¿èª
      description: ä¸‹æ›¸ããƒšãƒ¼ã‚¸ã‚’æ‰¿èªã—ã¦å…¬é–‹ï¼ˆãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ä»¥ä¸Šï¼‰
      tags:
        - wiki
      security:
        - bearerAuth: []
      parameters:
        - name: pageId
          in: path
          schema:
            type: string
      responses:
        "200":
          description: âœ… æ‰¿èªæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/wiki/{pageId}/history:
    get:
      summary: ğŸ“œ ç·¨é›†å±¥æ­´å–å¾—
      description: ãƒšãƒ¼ã‚¸ã®ç·¨é›†å±¥æ­´ã‚’å–å¾—
      tags:
        - wiki
      parameters:
        - name: pageId
          in: path
          schema:
            type: string
      responses:
        "200":
          description: âœ… ç·¨é›†å±¥æ­´
          content:
            application/json:
              schema:
                type: object
                properties:
                  history:
                    type: array
                    items:
                      $ref: "#/components/schemas/EditHistory"

  # ã‚³ãƒ¡ãƒ³ãƒˆé–¢é€£
  /api/comments:
    post:
      summary: ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿
      description: ãƒšãƒ¼ã‚¸ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
      tags:
        - comments
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - pageId
                - content
              properties:
                pageId:
                  type: string
                  example: "page-123"
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
                  example: "ã¨ã¦ã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸï¼"
            examples:
              positive_comment:
                summary: è‚¯å®šçš„ã‚³ãƒ¡ãƒ³ãƒˆ
                value:
                  pageId: "page-123"
                  content: "ç´ æ™´ã‚‰ã—ã„ãƒšãƒ¼ã‚¸ã§ã—ãŸï¼å‚è€ƒã«ãªã‚Šã¾ã™ã€‚"
              question_comment:
                summary: è³ªå•ã‚³ãƒ¡ãƒ³ãƒˆ
                value:
                  pageId: "page-123"
                  content: "å–¶æ¥­æ™‚é–“ã‚‚æ•™ãˆã¦ã„ãŸã ã‘ã¾ã›ã‚“ã‹ï¼Ÿ"
      responses:
        "201":
          description: âœ… æŠ•ç¨¿æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Comment posted successfully"
                  id:
                    type: string
                    example: "comment-123"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          description: âŒ æœªå…¬é–‹ãƒšãƒ¼ã‚¸ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/comments/page/{pageId}:
    get:
      summary: ğŸ“„ ãƒšãƒ¼ã‚¸ã®ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—
      description: æŒ‡å®šã—ãŸãƒšãƒ¼ã‚¸ã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ™‚ç³»åˆ—é †ã§å–å¾—
      tags:
        - comments
      parameters:
        - name: pageId
          in: path
          schema:
            type: string
          example: "page-123"
      responses:
        "200":
          description: âœ… ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: "#/components/schemas/Comment"

  /api/comments/{commentId}:
    put:
      summary: âœï¸ ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°
      description: è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ï¼ˆä½œè€…ã¾ãŸã¯ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ä»¥ä¸Šï¼‰
      tags:
        - comments
      security:
        - bearerAuth: []
      parameters:
        - name: commentId
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
      responses:
        "200":
          description: âœ… æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      summary: ğŸ—‘ï¸ ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤
      description: è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ï¼ˆä½œè€…ã¾ãŸã¯ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ä»¥ä¸Šï¼‰
      tags:
        - comments
      security:
        - bearerAuth: []
      parameters:
        - name: commentId
          in: path
          schema:
            type: string
      responses:
        "200":
          description: âœ… å‰Šé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/comments/user/{userId}:
    get:
      summary: ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
      description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
      tags:
        - comments
      parameters:
        - name: userId
          in: path
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        pageId:
                          type: string
                        pageTitle:
                          type: string
                        content:
                          type: string
                        createdAt:
                          type: string
                          format: date-time

  # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  /api/upload/image:
    post:
      summary: ğŸ“· ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      description: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’R2ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆèªè¨¼å¿…è¦ï¼‰
      tags:
        - upload
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: |
                    ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
                    - å¯¾å¿œå½¢å¼: JPEG, PNG, WebP, GIF
                    - æœ€å¤§ã‚µã‚¤ã‚º: 5MB
            encoding:
              image:
                contentType: image/*
      responses:
        "200":
          description: âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Image uploaded successfully"
                  url:
                    type: string
                    format: uri
                    example: "https://images.tsuruma-koala.com/user123/1234567890-image.jpg"
                  fileName:
                    type: string
                    example: "user123/1234567890-image.jpg"
                  size:
                    type: integer
                    example: 1024000
        "400":
          description: âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  code:
                    type: string
                    enum: [NO_FILE, FILE_TOO_LARGE, INVALID_FILE_TYPE]
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/upload/history:
    get:
      summary: ğŸ“‚ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å±¥æ­´å–å¾—
      description: è‡ªåˆ†ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å±¥æ­´ã‚’å–å¾—
      tags:
        - upload
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å±¥æ­´
          content:
            application/json:
              schema:
                type: object
                properties:
                  uploads:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        fileName:
                          type: string
                        originalName:
                          type: string
                        fileSize:
                          type: integer
                        mimeType:
                          type: string
                        url:
                          type: string
                        uploadedAt:
                          type: string
                          format: date-time

  /api/upload/{fileName}:
    delete:
      summary: ğŸ—‘ï¸ ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
      description: è‡ªåˆ†ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
      tags:
        - upload
      security:
        - bearerAuth: []
      parameters:
        - name: fileName
          in: path
          schema:
            type: string
          example: "user123/1234567890-image.jpg"
      responses:
        "200":
          description: âœ… å‰Šé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  # æ¤œç´¢æ©Ÿèƒ½
  /api/search:
    get:
      summary: ğŸ” å…¨æ–‡æ¤œç´¢
      description: ãƒšãƒ¼ã‚¸ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¨ªæ–­æ¤œç´¢
      tags:
        - search
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
            maxLength: 100
          description: æ¤œç´¢ã‚¯ã‚¨ãƒª
          example: "ã‚«ãƒ•ã‚§"
        - name: type
          in: query
          schema:
            type: string
            enum: [all, pages, users]
            default: all
          description: æ¤œç´¢å¯¾è±¡ã‚¿ã‚¤ãƒ—
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        "200":
          description: âœ… æ¤œç´¢çµæœ
          content:
            application/json:
              schema:
                type: object
                properties:
                  pages:
                    type: array
                    items:
                      $ref: "#/components/schemas/WikiPage"
                    description: "type=pagesã¾ãŸã¯type=allã®å ´åˆã®ã¿å«ã¾ã‚Œã‚‹"
                  users:
                    type: array
                    items:
                      $ref: "#/components/schemas/PublicUser"
                    description: "type=usersã¾ãŸã¯type=allã®å ´åˆã®ã¿å«ã¾ã‚Œã‚‹"
        "400":
          description: âŒ ã‚¯ã‚¨ãƒªä¸æ­£
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Search query is required"

  /api/search/tags:
    get:
      summary: ğŸ·ï¸ äººæ°—ã‚¿ã‚°å–å¾—
      description: ä½¿ç”¨é »åº¦é †ã®äººæ°—ã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—
      tags:
        - search
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
      responses:
        "200":
          description: âœ… äººæ°—ã‚¿ã‚°ä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  tags:
                    type: array
                    items:
                      type: object
                      properties:
                        tag:
                          type: string
                          example: "ã‚«ãƒ•ã‚§"
                        count:
                          type: integer
                          example: 15

  /api/search/suggestions:
    get:
      summary: ğŸ’¡ æ¤œç´¢å€™è£œå–å¾—
      description: å…¥åŠ›ä¸­ã®æ–‡å­—åˆ—ã«åŸºã¥ãæ¤œç´¢å€™è£œã‚’å–å¾—
      tags:
        - search
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
          example: "ã‚«ãƒ•"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 10
            default: 5
      responses:
        "200":
          description: âœ… æ¤œç´¢å€™è£œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  suggestions:
                    type: array
                    items:
                      type: string
                    example: ["ã‚«ãƒ•ã‚§ã‚¬ã‚¤ãƒ‰", "ã‚«ãƒ•ã‚§å·¡ã‚Š", "æ–°ã—ã„ã‚«ãƒ•ã‚§"]

  # ç®¡ç†è€…æ©Ÿèƒ½
  /api/admin/users:
    get:
      summary: ğŸ‘¥ å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
      description: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§ã‚’å–å¾—ãƒ»ç®¡ç†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [contributor, editor, moderator, admin]
          description: æ¨©é™ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        - name: search
          in: query
          schema:
            type: string
          description: ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãƒ»ãƒ¡ãƒ¼ãƒ«ã§æ¤œç´¢
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/User"
                        - type: object
                          properties:
                            pageCount:
                              type: integer
                              description: "æŠ•ç¨¿ãƒšãƒ¼ã‚¸æ•°"
                            commentCount:
                              type: integer
                              description: "ã‚³ãƒ¡ãƒ³ãƒˆæ•°"
                  total:
                    type: integer
                  hasMore:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/users/{userId}/role:
    put:
      summary: ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™å¤‰æ›´
      description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ãƒ¬ãƒ™ãƒ«ã‚’å¤‰æ›´ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          schema:
            type: string
          example: "user-123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [contributor, editor, moderator, admin]
                  example: "editor"
            examples:
              promote_to_editor:
                summary: ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã«æ˜‡æ ¼
                value:
                  role: "editor"
              promote_to_moderator:
                summary: ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«æ˜‡æ ¼
                value:
                  role: "moderator"
      responses:
        "200":
          description: âœ… æ¨©é™å¤‰æ›´æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: âŒ ç„¡åŠ¹ãªæ¨©é™
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          description: âŒ è‡ªåˆ†ã®æ¨©é™ã¯å¤‰æ›´ä¸å¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Cannot change your own role"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/admin/pages/pending:
    get:
      summary: â³ æ‰¿èªå¾…ã¡ãƒšãƒ¼ã‚¸ä¸€è¦§
      description: æ‰¿èªå¾…ã¡ã®ãƒšãƒ¼ã‚¸ä¸€è¦§ã‚’å–å¾—ï¼ˆãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ä»¥ä¸Šï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: âœ… æ‰¿èªå¾…ã¡ãƒšãƒ¼ã‚¸ä¸€è¦§
          content:
            application/json:
              schema:
                type: object
                properties:
                  pages:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/WikiPage"
                        - type: object
                          properties:
                            author:
                              allOf:
                                - $ref: "#/components/schemas/PublicUser"
                                - type: object
                                  properties:
                                    email:
                                      type: string
                                      description: "ç®¡ç†è€…å‘ã‘æƒ…å ±"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/stats:
    get:
      summary: ğŸ“Š ã‚µã‚¤ãƒˆçµ±è¨ˆæƒ…å ±
      description: ã‚µã‚¤ãƒˆå…¨ä½“ã®çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: âœ… çµ±è¨ˆæƒ…å ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalUsers:
                    type: integer
                    example: 1250
                    description: "ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°"
                  totalPages:
                    type: integer
                    example: 89
                    description: "å…¬é–‹ãƒšãƒ¼ã‚¸æ•°"
                  totalComments:
                    type: integer
                    example: 456
                    description: "ç·ã‚³ãƒ¡ãƒ³ãƒˆæ•°"
                  totalViews:
                    type: integer
                    example: 12340
                    description: "ç·ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼æ•°"
                  newUsersThisMonth:
                    type: integer
                    example: 23
                    description: "ä»Šæœˆã®æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°"
                  newPagesThisMonth:
                    type: integer
                    example: 8
                    description: "ä»Šæœˆã®æ–°è¦ãƒšãƒ¼ã‚¸æ•°"
                  viewsThisWeek:
                    type: integer
                    example: 789
                    description: "ä»Šé€±ã®ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼æ•°"
                  commentsThisWeek:
                    type: integer
                    example: 34
                    description: "ä»Šé€±ã®ã‚³ãƒ¡ãƒ³ãƒˆæ•°"
                  topPages:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        title:
                          type: string
                        viewCount:
                          type: integer
                    description: "äººæ°—ãƒšãƒ¼ã‚¸Top5"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/settings:
    get:
      summary: âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå–å¾—
      description: ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®ä¸€è¦§ã‚’å–å¾—ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: âœ… ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    type: object
                    additionalProperties: true
                    example:
                      site_name: "é¶´èˆã“ã‚ã‚‰Wiki"
                      site_description: "ã¿ã‚“ãªã§ä½œã‚‹é¶´èˆã®åœ°åŸŸæƒ…å ±"
                      allow_registration: true
                      require_email_verification: false
                      max_upload_size: 5242880
                      moderation_enabled: true
                      auto_approve_editors: true
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    put:
      summary: âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ›´æ–°
      description: ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’æ›´æ–°ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              example:
                site_name: "é¶´èˆã“ã‚ã‚‰Wiki"
                allow_registration: true
                moderation_enabled: true
      responses:
        "200":
          description: âœ… è¨­å®šæ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/logs:
    get:
      summary: ğŸ“‹ ç®¡ç†ãƒ­ã‚°å–å¾—
      description: ç®¡ç†è€…æ“ä½œãƒ­ã‚°ã‚’å–å¾—ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
      tags:
        - admin
      security:
        - bearerAuth: []
      parameters:
        - name: action
          in: query
          schema:
            type: string
          description: "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆrole_changeç­‰ï¼‰"
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 200
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: âœ… ç®¡ç†ãƒ­ã‚°
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        adminId:
                          type: string
                        adminNickname:
                          type: string
                        action:
                          type: string
                        targetType:
                          type: string
                        targetId:
                          type: string
                        oldValue:
                          type: string
                        newValue:
                          type: string
                        createdAt:
                          type: string
                          format: date-time
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

# ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®šç¾©
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer Tokenèªè¨¼

        **å–å¾—æ–¹æ³•:** `/api/auth/login` ã¾ãŸã¯ `/api/auth/register`

        **ãƒ˜ãƒƒãƒ€ãƒ¼ä¾‹:** `Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

        **æœ‰åŠ¹æœŸé™:** 7æ—¥é–“

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          example: "user-123"
        nickname:
          type: string
          example: "ã“ã‚ã‚‰ã¡ã‚ƒã‚“"
        email:
          type: string
          format: email
          example: "koala@example.com"
        role:
          type: string
          enum: [contributor, editor, moderator, admin]
          example: "contributor"
        avatarUrl:
          type: string
          format: uri
          nullable: true
          example: "https://images.tsuruma-koala.com/user123/avatar.jpg"
        bio:
          type: string
          nullable: true
          example: "é¶´èˆåœ°åŸŸãŒå¤§å¥½ãã§ã™ï¼"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true

    PublicUser:
      type: object
      properties:
        id:
          type: string
        nickname:
          type: string
        role:
          type: string
          enum: [contributor, editor, moderator, admin]
        avatarUrl:
          type: string
          format: uri
          nullable: true
        bio:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

    WikiPage:
      type: object
      properties:
        id:
          type: string
          example: "page-123"
        title:
          type: string
          example: "ğŸŒ¸ é¶´èˆå…¬åœ’ã®æ¥½ã—ã¿æ–¹"
        content:
          type: string
          description: "HTMLå½¢å¼ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„"
          example: "<h2>å…¬åœ’ã«ã¤ã„ã¦</h2><p>ç¾ã—ã„æ¡œã§æœ‰åãªå…¬åœ’ã§ã™ã€‚</p>"
        authorId:
          type: string
        author:
          $ref: "#/components/schemas/PublicUser"
        tags:
          type: array
          items:
            type: string
          example: ["é¶´èˆå…¬åœ’", "æ¡œ", "è¦³å…‰"]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [published, draft, archived]
        viewCount:
          type: integer
          example: 42

    WikiPageCreate:
      type: object
      required:
        - title
        - content
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: "æ–°ã—ã„ã‚«ãƒ•ã‚§ã®ç´¹ä»‹"
        content:
          type: string
          minLength: 1
          maxLength: 100000
          example: "<h2>æ–°ã‚ªãƒ¼ãƒ—ãƒ³</h2><p>ç´ æ•µãªã‚«ãƒ•ã‚§ãŒã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸã€‚</p>"
        tags:
          type: array
          items:
            type: string
            maxLength: 20
          maxItems: 10
          example: ["ã‚«ãƒ•ã‚§", "æ–°åº—èˆ—", "ã‚°ãƒ«ãƒ¡"]
          default: []

    WikiPageUpdate:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
        content:
          type: string
          minLength: 1
          maxLength: 100000
        tags:
          type: array
          items:
            type: string
            maxLength: 20
          maxItems: 10

    Comment:
      type: object
      properties:
        id:
          type: string
        pageId:
          type: string
        authorId:
          type: string
        author:
          $ref: "#/components/schemas/PublicUser"
        content:
          type: string
          example: "ã¨ã¦ã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸï¼"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true

    EditHistory:
      type: object
      properties:
        id:
          type: string
        pageId:
          type: string
        editorId:
          type: string
        editor:
          $ref: "#/components/schemas/PublicUser"
        titleBefore:
          type: string
          nullable: true
        titleAfter:
          type: string
          nullable: true
        contentBefore:
          type: string
          nullable: true
        contentAfter:
          type: string
          nullable: true
        editedAt:
          type: string
          format: date-time

    AuthResponse:
      type: object
      properties:
        message:
          type: string
          example: "Login successful"
        token:
          type: string
          description: "JWTèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ7æ—¥é–“æœ‰åŠ¹ï¼‰"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        user:
          $ref: "#/components/schemas/User"

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          example: "Operation completed successfully"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Resource not found"
        code:
          type: string
          example: "NOT_FOUND"
        details:
          type: object
          nullable: true
        requestId:
          type: string
          example: "req-123"

  responses:
    ValidationError:
      description: âŒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Validation failed"
              code:
                type: string
                example: "VALIDATION_ERROR"
              details:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        field:
                          type: string
                          example: "nickname"
                        message:
                          type: string
                          example: "Nickname is required"
                        code:
                          type: string
                          example: "invalid_type"
              requestId:
                type: string

    Unauthorized:
      description: âŒ èªè¨¼ãŒå¿…è¦
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            missing_token:
              summary: ãƒˆãƒ¼ã‚¯ãƒ³ãªã—
              value:
                error: "Authorization required"
                code: "MISSING_TOKEN"
            invalid_token:
              summary: ç„¡åŠ¹ãƒˆãƒ¼ã‚¯ãƒ³
              value:
                error: "Invalid token"
                code: "INVALID_TOKEN"
            expired_token:
              summary: æœŸé™åˆ‡ã‚Œ
              value:
                error: "Token expired"
                code: "TOKEN_EXPIRED"

    Forbidden:
      description: âŒ æ¨©é™ä¸è¶³
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: "Insufficient permissions"
            code: "INSUFFICIENT_PERMISSIONS"

    NotFound:
      description: âŒ ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: "Resource not found"
            code: "NOT_FOUND"

    RateLimitExceeded:
      description: âŒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é
      headers:
        X-RateLimit-Limit:
          description: åˆ¶é™å›æ•°
          schema:
            type: integer
        X-RateLimit-Remaining:
          description: æ®‹ã‚Šå›æ•°
          schema:
            type: integer
        X-RateLimit-Reset:
          description: ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ï¼ˆUnix timestampï¼‰
          schema:
            type: integer
        Retry-After:
          description: å†è©¦è¡Œã¾ã§ç§’æ•°
          schema:
            type: integer
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: "Rate limit exceeded"
            code: "RATE_LIMIT_EXCEEDED"
            details:
              retryAfter: 60

    InternalServerError:
      description: âŒ ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            error: "Internal server error"
            code: "INTERNAL_ERROR"

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼ˆå…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é©ç”¨ï¼‰
security: []
